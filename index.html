<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agendamento Avaliação Física Vila Império</title>

<style>
body{font-family:Arial;margin:0;background:#f4f6f9}
.topo{background:#111;color:#fff;padding:15px;text-align:center}
.container{display:flex}
.menu{width:220px;background:#1e1e2f;color:white;min-height:100vh;padding:20px}
.menu button{width:100%;margin-bottom:10px;padding:10px;border:none;cursor:pointer}
.area{flex:1;padding:20px}
.card{background:white;padding:10px;margin-bottom:10px;border-radius:6px}
button{cursor:pointer}
.hidden{display:none}
.calendario button{margin:2px;padding:8px;width:40px}
.horarios button{margin:5px;padding:8px}
</style>
</head>

<body>

<div class="topo">
<h2>Agendamento Avaliação Física Vila Império - 2026</h2>
</div>

<div class="container">

<div class="menu">
<button onclick="novoAgendamento()">Novo Agendamento</button>
<button onclick="bloquearDiaModo()">Bloquear Dia</button>
<button onclick="bloquearHorarioModo()">Bloquear Horário</button>
</div>

<div class="area">

<div id="calendario"></div>
<div id="horarios"></div>
<div id="listaDia"></div>

</div>
</div>

<script>

let usuarioTipo="admin";
let usuarioNome="admin";

let agendamentos=JSON.parse(localStorage.getItem("ag"))||[];
let bloqueios=JSON.parse(localStorage.getItem("blo"))||[];

let modoAgendamento=false;
let modoBloqueioDia=false;
let modoBloqueioHorario=false;

const horariosFixos=[
"06:30","06:50","07:50","08:10","08:30","08:50","09:10","09:30",
"16:00","16:20","16:40","17:00","17:20","17:40",
"18:00","18:20","18:40","19:20","19:40","21:00","21:20"
];

function salvar(){
localStorage.setItem("ag",JSON.stringify(agendamentos));
localStorage.setItem("blo",JSON.stringify(bloqueios));
}

function renderCalendario(){

let hoje=new Date();
let mes=hoje.getMonth();
let ano=hoje.getFullYear();

let dias=new Date(ano,mes+1,0).getDate();

let div=document.getElementById("calendario");
div.innerHTML="<h3>Calendário</h3><div class='calendario'>";

for(let d=1;d<=dias;d++){

let dia=String(d).padStart(2,"0");
let mesF=String(mes+1).padStart(2,"0");
let data=`${dia}/${mesF}/${ano}`;

let bloqueioDia=bloqueios.find(b=>b.data===data && b.tipo==="dia");

let style=bloqueioDia?"background:red;color:white":"";

div.innerHTML+=`<button style="${style}" onclick="clicarDia('${data}')">${d}</button>`;
}

div.innerHTML+="</div>";
}

function clicarDia(data){

let bloqueioDia=bloqueios.find(b=>b.data===data && b.tipo==="dia");

if(bloqueioDia && usuarioTipo!=="admin"){
alert("Este dia está bloqueado.");
return;
}

if(modoBloqueioDia){
bloqueios.push({data:data,tipo:"dia"});
salvar();
modoBloqueioDia=false;
renderCalendario();
return;
}

renderHorarios(data);
mostrarAgendamentosDoDia(data);
}

function renderHorarios(data){

let div=document.getElementById("horarios");
div.innerHTML="<h3>Horários</h3><div class='horarios'>";

horariosFixos.forEach(h=>{

let ocupado=agendamentos.find(a=>a.data===data && a.horario===h);
let bloqueado=bloqueios.find(b=>b.data===data && b.horario===h);

let style="";
if(ocupado) style="background:#ccc";
if(bloqueado) style="background:red;color:white";

div.innerHTML+=`<button style="${style}" onclick="clicarHorario('${data}','${h}')">${h}</button>`;

});

div.innerHTML+="</div>";
}

function clicarHorario(data,horario){

let bloqueioDia=bloqueios.find(b=>b.data===data && b.tipo==="dia");
if(bloqueioDia){ alert("Dia bloqueado"); return; }

let bloqueado=bloqueios.find(b=>b.data===data && b.horario===horario);
if(bloqueado){ alert("Horário bloqueado"); return; }

let ocupado=agendamentos.find(a=>a.data===data && a.horario===horario);
if(ocupado){ alert("Horário já ocupado"); return; }

if(modoAgendamento){

let nome=prompt("Nome do aluno:");
if(!nome) return;

let id=prompt("ID (até 10 números):");
if(!id || !/^[0-9]{1,10}$/.test(id)){alert("ID inválido");return;}

let alunoExistente=agendamentos.find(a=>a.id===id);
if(alunoExistente && alunoExistente.nome!==nome){
alert("Este ID já pertence a outro aluno.");
return;
}

agendamentos.push({
data:data,
horario:horario,
nome:nome,
id:id,
status:"pendente",
criadoPor:usuarioNome
});

salvar();
modoAgendamento=false;
renderHorarios(data);
mostrarAgendamentosDoDia(data);
}

if(modoBloqueioHorario){
bloqueios.push({data:data,horario:horario,tipo:"horario"});
salvar();
modoBloqueioHorario=false;
renderHorarios(data);
}

}

function mostrarAgendamentosDoDia(data){

let lista=agendamentos.filter(a=>a.data===data)
.sort((a,b)=>a.horario.localeCompare(b.horario));

let div=document.getElementById("listaDia");
div.innerHTML="<h3>Agendamentos do dia</h3>";

if(lista.length===0){
div.innerHTML+="Nenhum agendamento.";
return;
}

lista.forEach(a=>{

let botoes="";

if(usuarioTipo!=="professor"){

if(a.status==="pendente"){
botoes+=`<button style="background:#f1c40f" onclick="alterarStatus('${a.id}','${a.data}','${a.horario}','mensagem')">Mensagem enviada</button>`;
}

if(a.status==="mensagem"){
botoes+=`<button style="background:#3498db;color:white" onclick="alterarStatus('${a.id}','${a.data}','${a.horario}','confirmado')">Presença confirmada</button>`;
}

if(usuarioTipo==="admin"||a.criadoPor===usuarioNome){
botoes+=`<button style="background:#e74c3c;color:white" onclick="cancelarAgendamento('${a.id}','${a.data}','${a.horario}')">Cancelar</button>`;
}
}

if(usuarioTipo==="professor"){
botoes+=`<button style="background:#27ae60;color:white" onclick="alterarStatus('${a.id}','${a.data}','${a.horario}','realizado')">Avaliação realizada</button>`;
botoes+=`<button style="background:#c0392b;color:white" onclick="alterarStatus('${a.id}','${a.data}','${a.horario}','faltou')">Faltou</button>`;
}

div.innerHTML+=`
<div class="card">
<b>${a.horario}</b> - ${a.nome} (ID: ${a.id})<br>
Status: ${a.status}<br>
${botoes}
</div>
`;

});

}

function alterarStatus(id,data,horario,status){
let ag=agendamentos.find(a=>a.id===id&&a.data===data&&a.horario===horario);
if(!ag) return;
ag.status=status;
salvar();
mostrarAgendamentosDoDia(data);
}

function cancelarAgendamento(id,data,horario){

let index=agendamentos.findIndex(a=>a.id===id&&a.data===data&&a.horario===horario);
if(index===-1) return;

let ag=agendamentos[index];

if(usuarioTipo!=="admin"&&ag.criadoPor!==usuarioNome){
alert("Somente quem agendou ou o admin pode cancelar.");
return;
}

agendamentos.splice(index,1);
salvar();
renderHorarios(data);
mostrarAgendamentosDoDia(data);
}

function novoAgendamento(){
modoAgendamento=true;
modoBloqueioDia=false;
modoBloqueioHorario=false;
alert("Clique no dia e depois no horário.");
}

function bloquearDiaModo(){
modoBloqueioDia=true;
modoAgendamento=false;
modoBloqueioHorario=false;
alert("Clique no dia para bloquear.");
}

function bloquearHorarioModo(){
modoBloqueioHorario=true;
modoAgendamento=false;
modoBloqueioDia=false;
alert("Clique no dia e depois no horário para bloquear.");
}

renderCalendario();

</script>

</body>
</html>
