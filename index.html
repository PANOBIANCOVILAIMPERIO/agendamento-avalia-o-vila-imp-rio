<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agendamento Avaliação Física Vila Império</title>

<style>

body{
font-family:Arial;
margin:0;
background:#f0f2f5;
}

/* HEADER */

header{
text-align:center;
background:white;
padding:20px;
box-shadow:0 2px 5px rgba(0,0,0,0.2);
}

header.compacto{
padding:5px;
font-size:14px;
}

header img{
max-width:140px;
}

header.compacto img{
max-width:60px;
}

/* LOGIN */

.login-container{
display:flex;
justify-content:center;
align-items:center;
gap:40px;
height:60vh;
}

.login-box{

width:220px;
height:220px;

border:2px solid #ccc;

border-radius:12px;

display:flex;
justify-content:center;
align-items:center;

font-size:20px;
font-weight:bold;

cursor:pointer;

background:transparent;

transition:0.3s;

}

.login-box:hover{

background:#f5f5f5;

border-color:#1e88e5;

color:#1e88e5;

transform:scale(1.05);

}

/* PAINEL */

.container{
padding:20px;
}

button{
padding:10px 15px;
margin:5px;
border:none;
border-radius:6px;
cursor:pointer;
background:#1e88e5;
color:white;
}

button:hover{
background:#1565c0;
}

.card{
background:white;
padding:15px;
margin:10px 0;
border-radius:8px;
box-shadow:0 2px 5px rgba(0,0,0,0.2);
}

/* STATUS */

.status{
padding:4px 8px;
border-radius:4px;
color:white;
display:inline-block;
margin-top:5px;
}

.pendente{background:gray;}
.mensagem{background:orange;}
.confirmado{background:#1e88e5;}
.realizado{background:green;}
.faltou{background:red;}
.bloqueado{background:red;}
.treinamento{background:purple;}

/* CALENDARIO MODAL */

.modal{

position:fixed;

top:50%;
left:50%;

transform:translate(-50%,-50%);

background:white;

padding:20px;

border-radius:12px;

box-shadow:0 0 20px rgba(0,0,0,0.3);

z-index:1000;

}

.calendario{

display:grid;
grid-template-columns:repeat(7,1fr);
gap:5px;

}

.dia{

padding:10px;

background:white;

cursor:pointer;

border-radius:6px;

text-align:center;

}

.dia:hover{

background:#e3f2fd;

}

.hidden{
display:none;
}

</style>

</head>
<body>

<header id="header">

<img src="logo-panobianco.png">

<h2>Agendamento Avaliação Física Vila Império</h2>

<div id="ano"></div>

</header>

<div id="home" class="login-container">

<div class="login-box" onclick="loginAdmin()">
ADMIN
</div>

<div class="login-box" onclick="loginRecepcao()">
RECEPÇÃO
</div>

<div class="login-box" onclick="loginProfessor()">
PROFESSORES
</div>

</div>

<div id="painel" class="container hidden">

<button onclick="abrirAgendamento()">Novo Agendamento</button>

<button onclick="bloquearDia()">Bloquear Dia</button>

<button onclick="bloquearHorario()">Bloquear Horário</button>

<button onclick="logout()">Sair</button>

<div id="agenda"></div>

</div>

<div id="modalCalendario" class="modal hidden">

<button onclick="mesAnterior()">◀</button>

<span id="mesAno"></span>

<button onclick="mesProximo()">▶</button>

<div id="calendario" class="calendario"></div>

</div>

<script>

/* CONFIG */

const horarios=[

"06:30","06:50",
"07:50","08:10","08:30","08:50",
"09:10","09:30",
"16:00","16:20","16:40",
"17:00","17:20","17:40",
"18:00","18:20","18:40",
"19:20","19:40",
"21:00","21:20"

];

let agendamentos=
JSON.parse(localStorage.getItem("agendamentos")||"[]");

let usuarioTipo="";
let usuarioAtual="";

let mes=new Date().getMonth();
let ano=new Date().getFullYear();

document.getElementById("ano").innerText="Ano "+ano;

/* LOGIN */

function loginAdmin(){

let senha=prompt("Senha admin:");

if(senha==="696907"){

usuarioTipo="admin";
usuarioAtual="Admin";
entrar();

}

}

function loginRecepcao(){

let nome=prompt("Nome:");

usuarioTipo="recepcao";
usuarioAtual=nome;
entrar();

}

function loginProfessor(){

usuarioTipo="professor";
usuarioAtual="Professor";
entrar();

}

function entrar(){

document.getElementById("header").classList.add("compacto");

document.getElementById("home").classList.add("hidden");

document.getElementById("painel").classList.remove("hidden");

renderAgenda();

}

function logout(){

location.reload();

}

/* SALVAR */

function salvar(){

localStorage.setItem("agendamentos",
JSON.stringify(agendamentos));

}

/* CALENDARIO */

function abrirAgendamento(){

document.getElementById("modalCalendario")
.classList.remove("hidden");

renderCalendario();

}

function renderCalendario(){

let cal=document.getElementById("calendario");

cal.innerHTML="";

document.getElementById("mesAno").innerText=
(mes+1)+"/"+ano;

let dias=new Date(ano,mes+1,0).getDate();

for(let i=1;i<=dias;i++){

let data=
ano+"-"+String(mes+1).padStart(2,"0")
+"-"+String(i).padStart(2,"0");

let ocupados=
agendamentos.filter(a=>a.data===data);

let div=document.createElement("div");

div.className="dia";

div.innerText=i;

if(ocupados.length>=horarios.length){

div.style.background="red";
div.style.color="white";

}

div.onclick=()=>selecionarDia(data);

cal.appendChild(div);

}

}

function mesAnterior(){

mes--;

if(mes<0){mes=11;ano--;}

renderCalendario();

}

function mesProximo(){

mes++;

if(mes>11){mes=0;ano++;}

renderCalendario();

}

/* SELECIONAR DIA */

function selecionarDia(data){

let livres=
horarios.filter(h=>
!agendamentos.find(a=>
a.data===data && a.hora===h
));

let h=prompt(
"Horários disponíveis:\n"+
livres.join("\n")
);

if(!h)return;

let nome=prompt("Nome:");

let id=prompt("ID:");

let existente=
agendamentos.find(a=>a.id===id);

if(existente && existente.nome!==nome){

alert("ID já pertence a "+existente.nome);
return;

}

/* VERIFICAR 3 MESES */

let ultima=
agendamentos
.filter(a=>a.id===id && a.status==="realizado")
.sort((a,b)=>
new Date(b.data)-new Date(a.data)
)[0];

if(ultima){

let d=new Date(ultima.data);

d.setMonth(d.getMonth()+3);

if(new Date()<d){

if(!confirm(
"Avaliação antes de 3 meses.\nContinuar?"
))return;

}

}

agendamentos.push({

uid:Date.now(),

data,

hora:h,

nome,

id,

status:"pendente",

usuario:usuarioAtual

});

salvar();

renderAgenda();

}

/* BLOQUEIOS */

function bloquearDia(){

let data=prompt("Data YYYY-MM-DD");

horarios.forEach(h=>{

agendamentos.push({

uid:Date.now()+h,

data,

hora:h,

status:"bloqueado",

usuario:usuarioAtual

});

});

salvar();

renderAgenda();

}

function bloquearHorario(){

let data=prompt("Data YYYY-MM-DD");

let hora=prompt("Hora");

let tipo=prompt("1 bloqueio\n2 treinamento");

agendamentos.push({

uid:Date.now(),

data,

hora,

status:
tipo==="2"?"treinamento":"bloqueado",

usuario:usuarioAtual

});

salvar();

renderAgenda();

}

/* AGENDA */

function renderAgenda(){

let div=document.getElementById("agenda");

div.innerHTML="";

agendamentos
.sort((a,b)=>
new Date(a.data+" "+a.hora)
-
new Date(b.data+" "+b.hora)
)
.forEach(a=>{

let card=document.createElement("div");

card.className="card";

card.innerHTML=`

<b>${a.data} ${a.hora}</b><br>

${a.nome} (ID ${a.id})<br>

<span class="status ${a.status}">
${a.status}
</span><br>

${usuarioTipo!=="professor"
?`<button onclick="cancelar(${a.uid})">
Cancelar
</button>`:""}

<button onclick="status(${a.uid},'realizado')">
Realizado
</button>

<button onclick="status(${a.uid},'faltou')">
Faltou
</button>

`;

div.appendChild(card);

});

}

function cancelar(uid){

if(!confirm("Cancelar?"))return;

agendamentos=
agendamentos.filter(a=>a.uid!==uid);

salvar();

renderAgenda();

}

function status(uid,s){

let a=
agendamentos.find(x=>x.uid===uid);

if(a){

a.status=s;

salvar();

renderAgenda();

}

}

</script>

</body>
</html>
