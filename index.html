<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agendamento Avalia√ß√£o F√≠sica - Vila Imp√©rio</title>

<style>
body{margin:0;font-family:Arial;background:#f4f6f9}
.hidden{display:none}
button{cursor:pointer}
input{padding:6px;margin:4px 0;width:100%}

.header-login{text-align:center;padding:30px;background:white}
.header-login img{max-width:160px}
.login-container{display:flex;justify-content:center;gap:40px;margin-top:40px}
.login-box{
width:220px;height:220px;border:2px solid #ccc;border-radius:12px;
display:flex;justify-content:center;align-items:center;
font-size:22px;font-weight:bold;cursor:pointer;background:transparent
}
.login-box:hover{border-color:#1e88e5;color:#1e88e5}

.layout{display:flex;height:100vh}
.sidebar{width:250px;background:#1f2937;color:white;display:flex;flex-direction:column}
.sidebar-header{text-align:center;padding:20px;border-bottom:1px solid #333}
.sidebar button{background:none;border:none;color:white;padding:12px;text-align:left}
.sidebar button:hover{background:#374151}
.content{flex:1;padding:20px;overflow:auto}

.card{background:white;padding:12px;margin-bottom:10px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.2)}

.status{padding:3px 8px;border-radius:4px;color:white;font-size:12px}
.pendente{background:gray}
.mensagem{background:#facc15}
.confirmado{background:#2563eb}
.realizado{background:#16a34a}
.faltou{background:#dc2626}
.bloqueio{background:#dc2626}
.treinamento{background:#7c3aed}

.grid-horarios{
display:grid;
grid-template-columns:repeat(4,1fr);
gap:8px;
margin-top:15px;
}
.horario-btn{
padding:10px;
border:1px solid #ccc;
border-radius:6px;
background:white;
}
.horario-btn:hover{background:#e5e7eb}

.calendario-grid{
display:grid;
grid-template-columns:repeat(7,1fr);
gap:5px;
margin-top:15px;
}
.dia{
padding:10px;
background:white;
border:1px solid #ccc;
text-align:center;
cursor:pointer;
}
.dia.lotado{background:#fecaca}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
<div class="header-login">
<img src="logo-panobianco.png">
<h2>AGENDAMENTO AVALIA√á√ÉO F√çSICA</h2>
<h3>VILA IMP√âRIO - <span id="anoAtual"></span></h3>
</div>
<div class="login-container">
<div class="login-box" onclick="loginAdmin()">ADMIN</div>
<div class="login-box" onclick="loginRecepcao()">RECEP√á√ÉO</div>
<div class="login-box" onclick="loginProfessor()">PROFESSOR</div>
</div>
</div>

<!-- SISTEMA -->
<div id="app" class="layout hidden">

<div class="sidebar">
<div class="sidebar-header">
<img src="logo-panobianco.png" style="max-width:80px">
<h4 id="usuarioLogadoLabel"></h4>
</div>
<div id="menuLateral"></div>
<button onclick="logout()">Sair</button>
</div>

<div class="content">
<div id="areaPrincipal"></div>
</div>

</div>

<script>

/* =================== ESTADO =================== */

let usuarioTipo=null;
let usuarioNome=null;

let recepcionistas=JSON.parse(localStorage.getItem("recepcionistas")||"[]");
let agendamentos=JSON.parse(localStorage.getItem("agendamentos")||"[]");
let bloqueios=JSON.parse(localStorage.getItem("bloqueios")||"[]");

document.getElementById("anoAtual").innerText=new Date().getFullYear();

/* =================== LOGIN =================== */

function loginAdmin(){
let senha=prompt("Senha Admin:");
if(senha==="696907"){
usuarioTipo="admin";
usuarioNome="ADMIN";
entrar();
}
}

function loginRecepcao(){
let nome=prompt("Nome:");
let senha=prompt("Senha:");

let user=recepcionistas.find(r=>r.nome===nome && r.senha===senha);
if(user){
usuarioTipo="recepcao";
usuarioNome=nome;
entrar();
}else alert("Login inv√°lido");
}

function loginProfessor(){
usuarioTipo="professor";
usuarioNome="PROFESSOR";
entrar();
}

function logout(){location.reload();}

/* =================== ENTRAR =================== */

function entrar(){
limparAntigos();
document.getElementById("loginScreen").classList.add("hidden");
document.getElementById("app").classList.remove("hidden");
document.getElementById("usuarioLogadoLabel").innerText=usuarioNome;
renderMenu();
mostrarHoje();
}

/* =================== LIMPEZA 30 DIAS =================== */

function limparAntigos(){
let hoje=new Date();
agendamentos=agendamentos.filter(a=>{
let d=new Date(a.dataISO);
return ((hoje-d)/(1000*60*60*24))<=30;
});
bloqueios=bloqueios.filter(b=>{
let d=new Date(b.dataISO);
return ((hoje-d)/(1000*60*60*24))<=30;
});
salvar();
}

/* =================== MENU =================== */

function renderMenu(){
let m=document.getElementById("menuLateral");
m.innerHTML="";
m.innerHTML+=`<button onclick="mostrarHoje()">üìÖ Hoje</button>`;
m.innerHTML+=`<button onclick="abrirCalendario()">üìÜ Calend√°rio</button>`;
m.innerHTML+=`<button onclick="buscarID()">üîé Buscar ID</button>`;

if(usuarioTipo!=="professor"){
m.innerHTML+=`<button onclick="novoAgendamento()">‚ûï Novo</button>`;
m.innerHTML+=`<button onclick="bloquearDia()">üö´ Bloquear Dia</button>`;
m.innerHTML+=`<button onclick="bloquearHorario()">‚õî Bloquear Hor√°rio</button>`;
}

if(usuarioTipo==="admin"){
m.innerHTML+=`<button onclick="cadastroRecep()">üë• Recepcionistas</button>`;
}
}

/* =================== ORDENAR =================== */

function ordenar(){
agendamentos.sort((a,b)=>{
if(a.dataISO===b.dataISO) return a.horario.localeCompare(b.horario);
return new Date(a.dataISO)-new Date(b.dataISO);
});
}

/* =================== HOJE =================== */

function mostrarHoje(){
ordenar();
let hojeISO=new Date().toISOString().split("T")[0];
let lista=agendamentos.filter(a=>a.dataISO===hojeISO);
renderLista(lista,"Agendamentos de Hoje");
}

/* =================== RENDER LISTA =================== */

function renderLista(lista,titulo){
let area=document.getElementById("areaPrincipal");
area.innerHTML=`<h2>${titulo}</h2><button onclick="mostrarHoje()">‚¨Ö Voltar</button><br><br>`;
if(lista.length===0){area.innerHTML+="Nenhum.";return;}

lista.forEach(a=>{
area.innerHTML+=`
<div class="card">
<b>${formatar(a.dataISO)} - ${a.horario}</b><br>
${a.nome} (ID: ${a.id})<br>
<span class="status ${a.status}">${a.status}</span><br>
${acoes(a)}
</div>`;
});
}

/* =================== A√á√ïES =================== */

function acoes(a){
let h="";
if(usuarioTipo==="professor"){
h+=`<button onclick="alterar('${a.id}','${a.dataISO}','${a.horario}','realizado')">Realizada</button>`;
h+=`<button onclick="alterar('${a.id}','${a.dataISO}','${a.horario}','faltou')">Faltou</button>`;
}
if(usuarioTipo!=="professor"){
if(a.status==="pendente")h+=`<button onclick="alterar('${a.id}','${a.dataISO}','${a.horario}','mensagem')">Mensagem enviada</button>`;
if(a.status==="mensagem")h+=`<button onclick="alterar('${a.id}','${a.dataISO}','${a.horario}','confirmado')">Presen√ßa confirmada</button>`;
if(usuarioTipo==="admin"||a.criadoPor===usuarioNome)
h+=`<button onclick="cancelar('${a.id}','${a.dataISO}','${a.horario}')">Cancelar</button>`;
}
return h;
}

function alterar(id,dataISO,horario,status){
let a=agendamentos.find(x=>x.id===id&&x.dataISO===dataISO&&x.horario===horario);
if(!a)return;
a.status=status;
salvar();
mostrarHoje();
}

function cancelar(id,dataISO,horario){
let i=agendamentos.findIndex(x=>x.id===id&&x.dataISO===dataISO&&x.horario===horario);
if(i===-1)return;
if(usuarioTipo!=="admin"&&agendamentos[i].criadoPor!==usuarioNome){
alert("Somente respons√°vel ou admin");
return;
}
agendamentos.splice(i,1);
salvar();
mostrarHoje();
}

/* =================== NOVO AGENDAMENTO =================== */

function novoAgendamento(){
abrirCalendario(true);
}

/* =================== CALEND√ÅRIO =================== */

function abrirCalendario(modoAgendamento=false){

let area=document.getElementById("areaPrincipal");
let hoje=new Date();
let mes=hoje.getMonth();
let ano=hoje.getFullYear();

renderCalendario(mes,ano,modoAgendamento);
}

function renderCalendario(mes,ano,modoAgendamento){

let area=document.getElementById("areaPrincipal");
area.innerHTML=`<h2>Calend√°rio</h2>
<button onclick="mostrarHoje()">‚¨Ö Voltar</button>
<div class="calendario-grid" id="gridCal"></div>`;

let dias=new Date(ano,mes+1,0).getDate();
let grid=document.getElementById("gridCal");

for(let d=1;d<=dias;d++){
let dataISO=new Date(ano,mes,d).toISOString().split("T")[0];
let lotado=agendamentos.filter(a=>a.dataISO===dataISO).length>=21;
let div=document.createElement("div");
div.className="dia"+(lotado?" lotado":"");
div.innerText=d;
div.onclick=()=>selecionarDia(dataISO,modoAgendamento);
grid.appendChild(div);
}
}

/* =================== HOR√ÅRIOS =================== */

const horarios=[
"06:30","06:50","07:50","08:10","08:30","08:50","09:10","09:30",
"16:00","16:20","16:40","17:00","17:20","17:40","18:00","18:20","18:40",
"19:20","19:40","21:00","21:20"
];

function selecionarDia(dataISO,modoAgendamento){

let area=document.getElementById("areaPrincipal");
area.innerHTML=`<h2>${formatar(dataISO)}</h2>
<button onclick="abrirCalendario(${modoAgendamento})">‚¨Ö Voltar</button>
<div class="grid-horarios" id="gridHor"></div>`;

let grid=document.getElementById("gridHor");

horarios.forEach(h=>{
let ocupado=agendamentos.find(a=>a.dataISO===dataISO&&a.horario===h);
let bloqueado=bloqueios.find(b=>b.dataISO===dataISO&&b.horario===h);

let btn=document.createElement("button");
btn.className="horario-btn";
btn.innerText=h;

if(ocupado||bloqueado){
btn.disabled=true;
btn.style.background="#ddd";
}else if(modoAgendamento){
btn.onclick=()=>confirmarAgendamento(dataISO,h);
}

grid.appendChild(btn);
});
}

/* =================== CONFIRMAR =================== */

function confirmarAgendamento(dataISO,horario){

let nome=prompt("Nome do aluno:");
let id=prompt("ID num√©rico (at√© 10 d√≠gitos):");

if(!/^[0-9]{1,10}$/.test(id)){alert("ID inv√°lido");return;}
if(agendamentos.find(a=>a.id===id)){alert("ID j√° existente");return;}

agendamentos.push({
nome,id,dataISO,horario,
status:"pendente",
criadoPor:usuarioNome
});

salvar();
mostrarHoje();
}

/* =================== BLOQUEIO =================== */

function bloquearDia(){
abrirCalendario(false);
alert("Clique no dia desejado.");
}

function bloquearHorario(){
abrirCalendario(false);
alert("Clique no dia e escolha hor√°rio.");
}

/* =================== RECEPCIONISTAS =================== */

function cadastroRecep(){

let area=document.getElementById("areaPrincipal");
area.innerHTML=`<h2>Cadastro Recepcionistas</h2>
<input id="novoNome" placeholder="Nome √∫nico">
<input id="novaSenha" placeholder="Senha">
<button onclick="addRecep()">Cadastrar</button>
<button onclick="mostrarHoje()">‚¨Ö Voltar</button><br><br>`;

recepcionistas.forEach(r=>{
area.innerHTML+=`
<div class="card">
${r.nome}
<button onclick="removerRecep('${r.nome}')">Excluir</button>
</div>`;
});
}

function addRecep(){
let nome=document.getElementById("novoNome").value.trim();
let senha=document.getElementById("novaSenha").value.trim();
if(recepcionistas.find(r=>r.nome===nome)){alert("Nome j√° existe");return;}
recepcionistas.push({nome,senha});
localStorage.setItem("recepcionistas",JSON.stringify(recepcionistas));
cadastroRecep();
}

function removerRecep(nome){
recepcionistas=recepcionistas.filter(r=>r.nome!==nome);
localStorage.setItem("recepcionistas",JSON.stringify(recepcionistas));
cadastroRecep();
}

/* =================== BUSCA =================== */

function buscarID(){
let id=prompt("Digite ID:");
let lista=agendamentos.filter(a=>a.id===id);
renderLista(lista,"Resultado Busca");
}

/* =================== UTIL =================== */

function formatar(dataISO){
let d=new Date(dataISO);
return d.toLocaleDateString("pt-BR");
}

function salvar(){
localStorage.setItem("agendamentos",JSON.stringify(agendamentos));
localStorage.setItem("bloqueios",JSON.stringify(bloqueios));
}

</script>
</body>
</html>
