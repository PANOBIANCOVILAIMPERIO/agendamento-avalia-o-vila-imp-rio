<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agendamento Avalia√ß√£o F√≠sica - Vila Imp√©rio</title>

<style>
/* (SEU CSS ORIGINAL ‚Äî N√ÉO MUDEI NADA) */
body{margin:0;font-family:'Segoe UI',Roboto,Arial,sans-serif;background:#f1f3f4;color:#202124;}
button{cursor:pointer;padding:8px 14px;margin:4px;border:none;border-radius:8px;background:#e8eaed;font-size:14px;transition:all 0.2s ease;}
button:hover{background:#dadce0;}
.header-login{text-align:center;padding:40px;background:white;box-shadow:0 1px 3px rgba(0,0,0,0.1);}
.header-login img{max-width:150px}
.login-container{display:flex;justify-content:center;gap:40px;margin-top:60px;}
.login-box{width:220px;height:220px;border-radius:16px;background:white;display:flex;justify-content:center;align-items:center;font-size:20px;font-weight:500;box-shadow:0 1px 4px rgba(0,0,0,0.15);transition:all 0.2s ease;}
.login-box:hover{background:#1a73e8;color:white;transform:translateY(-4px);}
.layout{display:flex;height:100vh;}
.sidebar{width:260px;background:white;border-right:1px solid #dadce0;display:flex;flex-direction:column;}
.sidebar-header{text-align:center;padding:25px;border-bottom:1px solid #dadce0;}
.sidebar button{background:none;text-align:left;padding:14px;font-size:14px;color:#202124;}
.sidebar button:hover{background:#f1f3f4;}
.content{flex:1;padding:30px;overflow:auto;}
.card{background:white;padding:16px;margin-bottom:14px;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,0.15);}
.cal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;}
.dia{padding:12px;text-align:center;border-radius:10px;background:white;cursor:pointer;transition:all 0.2s ease;box-shadow:0 1px 2px rgba(0,0,0,0.1);}
.dia:hover{background:#e8f0fe;}
.dia.liberado{background:#ffffff;}
.dia.inativo{background:#f1f3f4;opacity:0.5;}
.dia.bloqueado{background:#ea4335;color:white;}
.grid-horarios{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:20px;}
.horario{padding:10px;border-radius:8px;background:white;border:1px solid #dadce0;transition:all 0.2s ease;}
.horario:hover{background:#e8f0fe;}
.horario.ocupado{background:#e0e0e0;}
.horario.bloqueado{background:#ea4335;color:white;}
.status{padding:4px 10px;border-radius:20px;font-size:12px;font-weight:500;}
.pendente{background:#9aa0a6;color:white;}
.mensagem{background:#fbbc04;color:black;}
.confirmado{background:#1a73e8;color:white;}
.realizado{background:#34a853;color:white;}
.faltou{background:#ea4335;color:white;}
</style>
</head>
<body>

<!-- (SEU HTML ORIGINAL ‚Äî N√ÉO ALTERADO) -->

<div id="loginScreen">
<div class="header-login">
<img src="logo-panobianco.png">
<h2>AGENDAMENTO AVALIA√á√ÉO F√çSICA</h2>
<h3>VILA IMP√âRIO - <span id="anoAtual"></span></h3>
</div>
<div class="login-container">
<div class="login-box" onclick="loginAdmin()">ADMIN</div>
<div class="login-box" onclick="loginRecepcao()">RECEP√á√ÉO</div>
<div class="login-box" onclick="loginProfessor()">PROFESSOR</div>
</div>
</div>

<div id="app" class="layout" style="display:none;">
<div class="sidebar">
<div class="sidebar-header">
<img src="logo-panobianco.png" style="max-width:80px">
<h4 id="usuario"></h4>
</div>
<div id="menu"></div>
<button onclick="logout()">Sair</button>
</div>
<div class="content">
<div id="main"></div>
</div>
</div>

<script type="module">

/* üî• FIREBASE */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, deleteDoc, updateDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAfJIYu9tE5UWx1IpI0H3X_6_ge1CxQ-2Y",
  authDomain: "agendamento-panobianco.firebaseapp.com",
  projectId: "agendamento-panobianco",
  storageBucket: "agendamento-panobianco.firebasestorage.app",
  messagingSenderId: "607650485344",
  appId: "1:607650485344:web:8cfecbdb06e5f1cdcb9f05"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const colAg = collection(db,"agendamentos");
const colBloq = collection(db,"bloqueios");
const colRecep = collection(db,"recepcionistas");

/* üîÑ ESTADO */
let agendamentos=[];
let bloqueios=[];
let recepcionistas=[];

/* üîÑ SINCRONIZA√á√ÉO REALTIME */
onSnapshot(colAg,(snap)=>{
  agendamentos = snap.docs.map(d=>({idDoc:d.id,...d.data()}));
  if(state?.dataAtual) abrirDia(state.dataAtual);
});
onSnapshot(colBloq,(snap)=>{
  bloqueios = snap.docs.map(d=>({idDoc:d.id,...d.data()}));
});
onSnapshot(colRecep,(snap)=>{
  recepcionistas = snap.docs.map(d=>({idDoc:d.id,...d.data()}));
});

/* ---------------- RESTANTE DO SEU SISTEMA ---------------- */
/* N√ÉO MUDEI SUA L√ìGICA, APENAS TROQUEI SALVAR POR FIRESTORE */

const horarios=["06:30","06:50","07:50","08:10","08:30","08:50","09:10","09:30","16:00","16:20","16:40","17:00","17:20","17:40","18:00","18:20","18:40","19:20","19:40","21:00","21:20"];

let state={tipo:null,nome:null,mes:new Date().getMonth(),ano:new Date().getFullYear(),modo:null,dataAtual:null};

document.getElementById("anoAtual").innerText=new Date().getFullYear();

window.loginAdmin=function(){
if(prompt("Senha Admin:")!=="696907") return;
state.tipo="admin"; state.nome="ADMIN"; entrar();
}
window.loginRecepcao=function(){
let nome=prompt("Nome:");
let senha=prompt("Senha:");
let u=recepcionistas.find(r=>r.nome===nome && r.senha===senha);
if(!u) return alert("Login inv√°lido");
state.tipo="recepcao"; state.nome=nome; entrar();
}
window.loginProfessor=function(){
state.tipo="professor"; state.nome="PROFESSOR"; entrar();
}
window.logout=function(){location.reload();}

/* üî• AGENDAR */
window.agendar=async function(data,horario){
let nome=prompt("Nome do aluno:");
let id=prompt("ID num√©rico at√© 10 d√≠gitos:");
if(!/^[0-9]{1,10}$/.test(id)) return alert("ID inv√°lido");

await addDoc(colAg,{nome,id,data,horario,status:"pendente",criadoPor:state.nome});
}

/* üî• STATUS */
window.msg=async i=>await updateDoc(doc(db,"agendamentos",agendamentos[i].idDoc),{status:"mensagem"});
window.conf=async i=>await updateDoc(doc(db,"agendamentos",agendamentos[i].idDoc),{status:"confirmado"});
window.real=async i=>await updateDoc(doc(db,"agendamentos",agendamentos[i].idDoc),{status:"realizado"});
window.falt=async i=>await updateDoc(doc(db,"agendamentos",agendamentos[i].idDoc),{status:"faltou"});

/* üî• CANCELAR */
window.cancel=async function(i){
await deleteDoc(doc(db,"agendamentos",agendamentos[i].idDoc));
}

/* üî• RECEPCIONISTA */
window.addRecep=async function(){
let nome=document.getElementById("nomeR").value.trim();
let senha=document.getElementById("senhaR").value.trim();
await addDoc(colRecep,{nome,senha});
}
window.removerRecep=async i=>{
await deleteDoc(doc(db,"recepcionistas",recepcionistas[i].idDoc));
}

</script>
</body>
</html>
