<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agendamento Avalia√ß√£o F√≠sica - Vila Imp√©rio</title>

<style>
body{margin:0;font-family:Arial;background:#f4f6f9}
.hidden{display:none}
button{cursor:pointer;padding:6px 10px;margin:4px}
input{padding:6px;margin:4px 0;width:100%}

.header-login{text-align:center;padding:30px;background:white}
.header-login img{max-width:160px}
.login-container{display:flex;justify-content:center;gap:40px;margin-top:40px}
.login-box{
width:220px;height:220px;border:2px solid #ccc;border-radius:12px;
display:flex;justify-content:center;align-items:center;
font-size:22px;font-weight:bold;cursor:pointer;background:transparent
}
.login-box:hover{border-color:#1e88e5;color:#1e88e5}

.layout{display:flex;height:100vh}
.sidebar{width:260px;background:#1f2937;color:white;display:flex;flex-direction:column}
.sidebar-header{text-align:center;padding:20px;border-bottom:1px solid #333}
.sidebar button{background:none;border:none;color:white;padding:12px;text-align:left}
.sidebar button:hover{background:#374151}
.content{flex:1;padding:20px;overflow:auto}

.card{background:white;padding:12px;margin-bottom:10px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.2)}

.cal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:5px}
.dia{padding:10px;text-align:center;border:1px solid #ccc;cursor:pointer}
.dia.liberado{background:#e6f4ea}
.dia.inativo{background:#f3f4f6;opacity:0.4}
.dia.bloqueado{background:#dc2626;color:white}

.grid-horarios{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:15px}
.horario{padding:10px;border:1px solid #ccc;border-radius:6px;background:white}
.horario.ocupado{background:#ddd}
.horario.bloqueado{background:#dc2626;color:white}

.status{padding:4px 8px;border-radius:4px;color:white;font-size:12px;display:inline-block;margin:5px 0}
.pendente{background:gray}
.mensagem{background:#facc15}
.confirmado{background:#2563eb}
.realizado{background:#16a34a}
.faltou{background:#dc2626}
</style>
</head>
<body>

<div id="loginScreen">
<div class="header-login">
<img src="logo-panobianco.png">
<h2>AGENDAMENTO AVALIA√á√ÉO F√çSICA</h2>
<h3>VILA IMP√âRIO - <span id="anoAtual"></span></h3>
</div>
<div class="login-container">
<div class="login-box" onclick="loginAdmin()">ADMIN</div>
<div class="login-box" onclick="loginRecepcao()">RECEP√á√ÉO</div>
<div class="login-box" onclick="loginProfessor()">PROFESSOR</div>
</div>
</div>

<div id="app" class="layout hidden">
<div class="sidebar">
<div class="sidebar-header">
<img src="logo-panobianco.png" style="max-width:80px">
<h4 id="usuario"></h4>
</div>
<div id="menu"></div>
<button onclick="logout()">Sair</button>
</div>
<div class="content">
<div id="main"></div>
</div>
</div>

<script>

/* ================= ESTADO ================= */

let state={
tipo:null,
nome:null,
mes:new Date().getMonth(),
ano:new Date().getFullYear(),
modo:null,
dataAtual:null
};

let agendamentos=JSON.parse(localStorage.getItem("agendamentos")||"[]");
let bloqueios=JSON.parse(localStorage.getItem("bloqueios")||"[]");
let recepcionistas=JSON.parse(localStorage.getItem("recepcionistas")||"[]");

document.getElementById("anoAtual").innerText=new Date().getFullYear();

/* ================= LIMPEZA AUTOM√ÅTICA 30 DIAS ================= */

function limparAntigos(){
let hoje=new Date();

agendamentos=agendamentos.filter(a=>{
let dataAg=new Date(a.data);
let diff=(hoje-dataAg)/(1000*60*60*24);
return diff<=30;
});

bloqueios=bloqueios.filter(b=>{
let dataBloq=new Date(b.data);
let diff=(hoje-dataBloq)/(1000*60*60*24);
return diff<=30;
});

salvar();
}

limparAntigos();

/* ================= LOGIN ================= */

function loginAdmin(){
if(prompt("Senha Admin:")!=="696907") return;
state.tipo="admin"; state.nome="ADMIN"; entrar();
}

function loginRecepcao(){
let nome=prompt("Nome:");
let senha=prompt("Senha:");
let u=recepcionistas.find(r=>r.nome===nome && r.senha===senha);
if(!u) return alert("Login inv√°lido");
state.tipo="recepcao"; state.nome=nome; entrar();
}

function loginProfessor(){
state.tipo="professor"; state.nome="PROFESSOR"; entrar();
}

function entrar(){
document.getElementById("loginScreen").classList.add("hidden");
document.getElementById("app").classList.remove("hidden");
document.getElementById("usuario").innerText=state.nome;
renderMenu();
renderCalendario();
}

function logout(){location.reload();}

/* ================= MENU ================= */

function renderMenu(){
let m=document.getElementById("menu");
m.innerHTML="";

m.innerHTML+=`<button onclick="renderCalendario()">üìÜ Calend√°rio</button>`;
m.innerHTML+=`<button onclick="buscarID()">üîé Buscar por ID</button>`;

if(state.tipo!=="professor"){
m.innerHTML+=`<button onclick="state.modo='agendar';renderCalendario()">‚ûï Agendar</button>`;
m.innerHTML+=`<button onclick="state.modo='bloqDia';renderCalendario()">üö´ Bloquear Dia</button>`;
m.innerHTML+=`<button onclick="state.modo='bloqHora';renderCalendario()">‚õî Bloquear Hor√°rio</button>`;
}

if(state.tipo==="admin"){
m.innerHTML+=`<button onclick="abrirRecep()">üë• Recepcionistas</button>`;
}
}

/* ================= BUSCA POR ID ================= */

function buscarID(){
let main=document.getElementById("main");
main.innerHTML=`
<h2>Buscar por ID</h2>
<input id="buscaID" placeholder="Digite o ID">
<button onclick="executarBusca()">Buscar</button>
<button onclick="renderCalendario()">‚¨Ö Voltar</button>
<div id="resultadoBusca"></div>`;
}

function executarBusca(){
let id=document.getElementById("buscaID").value.trim();
let div=document.getElementById("resultadoBusca");
div.innerHTML="";

let resultados=agendamentos.filter(a=>a.id===id);

if(resultados.length===0){
div.innerHTML="<p>Nenhum agendamento encontrado.</p>";
return;
}

resultados.forEach(a=>{
div.innerHTML+=`
<div class="card">
<b>${a.nome}</b><br>
Data: ${a.data}<br>
Hor√°rio: ${a.horario}<br>
Status: ${a.status}
</div>`;
});
}

/* ================= RESTANTE DO SISTEMA ================= */
/* (Calend√°rio, Agendamento, Status, Bloqueios etc continuam iguais ao anterior) */

function salvar(){
localStorage.setItem("agendamentos",JSON.stringify(agendamentos));
localStorage.setItem("bloqueios",JSON.stringify(bloqueios));
localStorage.setItem("recepcionistas",JSON.stringify(recepcionistas));
}

</script>
</body>
</html>
