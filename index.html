<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agendamento Avalia√ß√£o F√≠sica - Vila Imp√©rio</title>

<style>
body{margin:0;font-family:Arial;background:#f4f6f9}
.hidden{display:none}
button{cursor:pointer;padding:6px 10px;margin:4px}
input{padding:6px;margin:4px 0;width:100%}

.header-login{text-align:center;padding:30px;background:white}
.header-login img{max-width:160px}
.login-container{display:flex;justify-content:center;gap:40px;margin-top:40px}
.login-box{
width:220px;height:220px;border:2px solid #ccc;border-radius:12px;
display:flex;justify-content:center;align-items:center;
font-size:22px;font-weight:bold;cursor:pointer;background:transparent
}
.login-box:hover{border-color:#1e88e5;color:#1e88e5}

.layout{display:flex;height:100vh}
.sidebar{width:260px;background:#1f2937;color:white;display:flex;flex-direction:column}
.sidebar-header{text-align:center;padding:20px;border-bottom:1px solid #333}
.sidebar button{background:none;border:none;color:white;padding:12px;text-align:left}
.sidebar button:hover{background:#374151}
.content{flex:1;padding:20px;overflow:auto}

.card{background:white;padding:12px;margin-bottom:10px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.2)}

.calendario-header{display:flex;justify-content:space-between;align-items:center}
.calendario-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;margin-top:10px}
.dia{padding:10px;text-align:center;border:1px solid #ccc;cursor:pointer}
.dia.bloqueado{background:#dc2626;color:white}

.grid-horarios{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:15px}
.horario-btn{padding:10px;border:1px solid #ccc;border-radius:6px;background:white}
.horario-btn.ocupado{background:#ddd}
.horario-btn.bloqueado{background:#dc2626;color:white}
.horario-btn.treinamento{background:#7c3aed;color:white}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
<div class="header-login">
<img src="logo-panobianco.png">
<h2>AGENDAMENTO AVALIA√á√ÉO F√çSICA</h2>
<h3>VILA IMP√âRIO - <span id="anoAtual"></span></h3>
</div>
<div class="login-container">
<div class="login-box" onclick="loginAdmin()">ADMIN</div>
<div class="login-box" onclick="loginRecepcao()">RECEP√á√ÉO</div>
<div class="login-box" onclick="loginProfessor()">PROFESSOR</div>
</div>
</div>

<!-- APP -->
<div id="app" class="layout hidden">
<div class="sidebar">
<div class="sidebar-header">
<img src="logo-panobianco.png" style="max-width:80px">
<h4 id="usuarioLogadoLabel"></h4>
</div>
<div id="menuLateral"></div>
<button onclick="logout()">Sair</button>
</div>
<div class="content">
<div id="areaPrincipal"></div>
</div>
</div>

<script>

let usuarioTipo=null;
let usuarioNome=null;

let recepcionistas=JSON.parse(localStorage.getItem("recepcionistas")||"[]");
let agendamentos=JSON.parse(localStorage.getItem("agendamentos")||"[]");
let bloqueios=JSON.parse(localStorage.getItem("bloqueios")||"[]");

document.getElementById("anoAtual").innerText=new Date().getFullYear();

/* LOGIN */

function loginAdmin(){
let senha=prompt("Senha Admin:");
if(senha==="696907"){
usuarioTipo="admin";
usuarioNome="ADMIN";
entrar();
}
}

function loginRecepcao(){
let nome=prompt("Nome:");
let senha=prompt("Senha:");
let user=recepcionistas.find(r=>r.nome===nome&&r.senha===senha);
if(user){
usuarioTipo="recepcao";
usuarioNome=nome;
entrar();
}else alert("Login inv√°lido");
}

function loginProfessor(){
usuarioTipo="professor";
usuarioNome="PROFESSOR";
entrar();
}

function logout(){location.reload();}

/* ENTRAR */

function entrar(){
document.getElementById("loginScreen").classList.add("hidden");
document.getElementById("app").classList.remove("hidden");
document.getElementById("usuarioLogadoLabel").innerText=usuarioNome;
renderMenu();
abrirCalendario();
}

/* MENU */

function renderMenu(){
let m=document.getElementById("menuLateral");
m.innerHTML="";

m.innerHTML+=`<button onclick="abrirCalendario()">üìÜ Calend√°rio</button>`;

if(usuarioTipo!=="professor"){
m.innerHTML+=`<button onclick="novoAgendamento()">‚ûï Agendar Avalia√ß√£o</button>`;
m.innerHTML+=`<button onclick="modoBloqueioDia()">üö´ Bloquear Dia</button>`;
m.innerHTML+=`<button onclick="modoBloqueioHorario()">‚õî Bloquear Hor√°rio</button>`;
}

if(usuarioTipo==="admin"){
m.innerHTML+=`<button onclick="cadastroRecep()">üë• Recepcionistas</button>`;
}
}

/* MODOS */

let modoAgendamento=false;
let modoBloqueioDiaAtivo=false;
let modoBloqueioHorarioAtivo=false;

function novoAgendamento(){
modoAgendamento=true;
modoBloqueioDiaAtivo=false;
modoBloqueioHorarioAtivo=false;
renderCalendario();
}

function modoBloqueioDia(){
modoBloqueioDiaAtivo=true;
modoAgendamento=false;
modoBloqueioHorarioAtivo=false;
renderCalendario();
}

function modoBloqueioHorario(){
modoBloqueioHorarioAtivo=true;
modoAgendamento=false;
modoBloqueioDiaAtivo=false;
renderCalendario();
}

/* CALEND√ÅRIO */

let mesAtual=new Date().getMonth();
let anoAtual=new Date().getFullYear();

function abrirCalendario(){
modoAgendamento=false;
modoBloqueioDiaAtivo=false;
modoBloqueioHorarioAtivo=false;
renderCalendario();
}

function renderCalendario(){

let area=document.getElementById("areaPrincipal");

area.innerHTML=`
<div class="calendario-header">
<button onclick="mesAnterior()">‚óÄ</button>
<h2>${nomeMes(mesAtual)} ${anoAtual}</h2>
<button onclick="mesSeguinte()">‚ñ∂</button>
</div>

<div class="calendario-grid" style="font-weight:bold">
<div>DOM</div><div>SEG</div><div>TER</div><div>QUA</div><div>QUI</div><div>SEX</div><div>SAB</div>
</div>

<div class="calendario-grid" id="gridCal"></div>
`;

let primeiroDia=new Date(anoAtual,mesAtual,1).getDay();
let dias=new Date(anoAtual,mesAtual+1,0).getDate();

let grid=document.getElementById("gridCal");

for(let i=0;i<primeiroDia;i++){
grid.appendChild(document.createElement("div"));
}

for(let d=1;d<=dias;d++){

let data=formatarISO(anoAtual,mesAtual,d);
let diaSemana=new Date(data).getDay();

let div=document.createElement("div");
div.className="dia";
div.innerText=d;

// visual
if(diaSemana>=2 && diaSemana<=5){
div.style.background="#e6f4ea";
div.onclick=()=>clicarDia(data);
}else{
div.style.background="#f3f4f6";
div.style.opacity="0.5";
}

let bloqueioDia=bloqueios.find(b=>b.data===data&&b.tipo==="dia");
if(bloqueioDia){
div.classList.add("bloqueado");
}

grid.appendChild(div);
}
}

function mesAnterior(){mesAtual--;if(mesAtual<0){mesAtual=11;anoAtual--;}renderCalendario();}
function mesSeguinte(){mesAtual++;if(mesAtual>11){mesAtual=0;anoAtual++;}renderCalendario();}
function nomeMes(m){return["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"][m];}

/* DIA */

const horarios=["06:30","06:50","07:50","08:10","08:30","08:50","09:10","09:30","16:00","16:20","16:40","17:00","17:20","17:40","18:00","18:20","18:40","19:20","19:40","21:00","21:20"];

function clicarDia(data){

let bloqueioDia=bloqueios.find(b=>b.data===data&&b.tipo==="dia");

if(bloqueioDia && usuarioTipo!=="admin"){
alert("Dia bloqueado");
return;
}

if(modoBloqueioDiaAtivo){
bloqueios.push({data,tipo:"dia"});
salvar();
renderCalendario();
return;
}

let area=document.getElementById("areaPrincipal");

area.innerHTML=`<h2>${data}</h2>
<button onclick="renderCalendario()">‚¨Ö Voltar</button>
<div id="adminDesbloqueio"></div>
<div class="grid-horarios" id="gridHor"></div>
`;

if(bloqueioDia && usuarioTipo==="admin"){
document.getElementById("adminDesbloqueio").innerHTML=
`<button onclick="desbloquearDia('${data}')">üîì Desbloquear Dia</button>`;
}

let grid=document.getElementById("gridHor");

horarios.forEach(h=>{

let btn=document.createElement("button");
btn.className="horario-btn";
btn.innerText=h;

let ocupado=agendamentos.find(a=>a.data===data&&a.horario===h);
let bloqueado=bloqueios.find(b=>b.data===data&&b.horario===h);

if(ocupado){btn.classList.add("ocupado");btn.disabled=true;}

if(bloqueado){
btn.classList.add("bloqueado");
if(usuarioTipo==="admin"){
btn.onclick=()=>desbloquearHorario(data,h);
}else btn.disabled=true;
}

if(modoAgendamento&&!ocupado&&!bloqueado){
btn.onclick=()=>confirmarAgendamento(data,h);
}

if(modoBloqueioHorarioAtivo&&!ocupado&&!bloqueado){
btn.onclick=()=>{
bloqueios.push({data,horario:h,tipo:"horario"});
salvar();
clicarDia(data);
};
}

grid.appendChild(btn);
});
}

/* AGENDAR */

function confirmarAgendamento(data,horario){

let nome=prompt("Nome do aluno:");
let id=prompt("ID num√©rico at√© 10 d√≠gitos:");

if(!/^[0-9]{1,10}$/.test(id)){
alert("ID inv√°lido");
return;
}

let existente=agendamentos.find(a=>a.id===id);
if(existente && existente.nome!==nome){
alert("ID j√° vinculado a outro nome");
return;
}

agendamentos.push({nome,id,data,horario});
salvar();

modoAgendamento=false;
clicarDia(data);
}

/* DESBLOQUEIO */

function desbloquearDia(data){
bloqueios=bloqueios.filter(b=>!(b.data===data&&b.tipo==="dia"));
salvar();
renderCalendario();
}

function desbloquearHorario(data,h){
bloqueios=bloqueios.filter(b=>!(b.data===data&&b.horario===h));
salvar();
clicarDia(data);
}

/* RECEPCIONISTAS */

function cadastroRecep(){
if(usuarioTipo!=="admin"){alert("Somente admin");return;}
let area=document.getElementById("areaPrincipal");
area.innerHTML=`<h2>Recepcionistas</h2>
<input id="novoNome" placeholder="Nome √∫nico">
<input id="novaSenha" placeholder="Senha">
<button onclick="addRecep()">Cadastrar</button>
<button onclick="abrirCalendario()">‚¨Ö Voltar</button>
<hr><div id="listaRecep"></div>`;
renderListaRecep();
}

function renderListaRecep(){
let lista=document.getElementById("listaRecep");
lista.innerHTML="";
recepcionistas.forEach(r=>{
lista.innerHTML+=`<div class="card">
<b>${r.nome}</b><br>Senha: ${r.senha}<br>
<button onclick="excluirRecep('${r.nome}')">Excluir</button>
</div>`;
});
}

function addRecep(){
let nome=document.getElementById("novoNome").value.trim();
let senha=document.getElementById("novaSenha").value.trim();
if(recepcionistas.find(r=>r.nome===nome)){alert("Nome j√° existe");return;}
recepcionistas.push({nome,senha});
localStorage.setItem("recepcionistas",JSON.stringify(recepcionistas));
renderListaRecep();
}

function excluirRecep(nome){
recepcionistas=recepcionistas.filter(r=>r.nome!==nome);
localStorage.setItem("recepcionistas",JSON.stringify(recepcionistas));
renderListaRecep();
}

/* UTIL */

function formatarISO(ano,mes,dia){
let m=String(mes+1).padStart(2,"0");
let d=String(dia).padStart(2,"0");
return `${ano}-${m}-${d}`;
}

function salvar(){
localStorage.setItem("agendamentos",JSON.stringify(agendamentos));
localStorage.setItem("bloqueios",JSON.stringify(bloqueios));
}

</script>
</body>
</html>
